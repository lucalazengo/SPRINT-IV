
<!doctype html>
<html lang="pt_BR">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="includes/css/bootstrap.min.css">
		<link rel="stylesheet" href="includes/css/datatables.min.css">
		<link rel="stylesheet" href="includes/css/toastr.min.css">
		<link rel="stylesheet" href="includes/css/jquery.uploader.min.css">
		<link rel="stylesheet" href="includes/css/bootstrap-datepicker.min.css">
		<link rel="stylesheet" href="includes/css/select2.min.css">
		<link rel="stylesheet" href="includes/css/padrao.css?t=1741720008">
		<script src="https://sso.cloud.pje.jus.br/auth/js/keycloak.js"></script>
		<script src="includes/js/jquery.min.js"></script>
		<script src="includes/js/bootstrap.min.js"></script>
		<script src="includes/js/datatables.min.js"></script>
		<script src="includes/js/toastr.min.js"></script>
		<script src="includes/js/jquery.uploader.min.js"></script>
		<script src="includes/js/bootstrap-datepicker.min.js"></script>
		<script src="includes/js/select2.min.js"></script>
		<script src="includes/js/jquery.mask.min.js"></script>
		<script src="includes/js/jquery.sticky-kit.min.js"></script>
		<script src="includes/js/bootbox.min.js"></script>
		<script src="includes/ckeditor/ckeditor.js?t=1741720008"></script>
		<script src="includes/js/functions.js?t=1741720008"></script>
		<script src="https://www.google.com/recaptcha/api.js?render=explicit"></script>
		<link rel="shortcut icon" href="includes/images/favicon.png" type="image/x-icon">
		<title>Sistema e-NatJus</title>
	</head>
	<body>
<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="collapsed navbar-toggle" data-toggle="collapse" data-target="#navbar"><span class="glyphicon glyphicon-menu-hamburger"></span></button>
			<a href="index.php" class="navbar-brand" style="padding:5px 10px 5px 15px"><img src="includes/images/logotipo-menu.png"></a>
		</div>
		<div class="collapse navbar-collapse" id="navbar">
			<ul class="nav navbar-nav">
				<li id="parecerTecnico-listar"><a href="parecerTecnico-listar.php">Pareceres</a></li>
				<li id="pesquisaPublica"><a href="pesquisaPublica.php">Notas</a></li>
				<li id="pesquisaPublica"><a href="faq.php">FAQ</a></li>
			</ul>
			<div class="btn-group navbar-right" style="margin-right:0">
				<a class="btn btn-default navbar-btn" href="index.php"><span class="glyphicon glyphicon-log-in"></span> Login</a>
			</div>
		</div>
	</div>
</nav>
<script>
	if (!isTouchDevice()) {
		$(".navbar .tooltipButton").tooltip({placement:'bottom'});
	}
	function logoff() {
		apiCall('usuario/logoff', null, function(response){
			if (response.success == true) {
				sessionStorage.clear();
				window.location = 'index.php?logoff=true';
			}
			else {
				showToast('error', 'Falha ao realizar logoff');
			}
		});
	}
</script>
		<div class="container" id="conteudo">
<h1 class="title">Pesquisa de Notas Técnicas
</h1>
<div class="form-horizontal well" id="formParecer">
	<form id='frmPesquisa'>
	<input type="hidden" name="token" id="token" value="pesquisaPublica:1747330200:7da0cff01b16326bc28b342c8e99bcea85ca140d9d63cf2fd507e46b4d71b30c">
<div class="form-group" style="margin:0">
	<p class="lead"  >Diagnóstico Principal</p>
</div>
<div class="form-group  col-md-6" >
	<label for="txtCid" class="col-sm-4 control-label">CID</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="txtCid" id="txtCid" data-source="cid">
		</select>
	</div>
</div>
<div class="form-group col-md-6" >
	<label for="txtDescAvaliacaoDiagnosticoSemCID" class="col-sm-4 control-label">Diagnóstico</label>
	<div class="col-sm-8 col-lg-7">
		<input class="form-control  " name="txtDescAvaliacaoDiagnosticoSemCID" id="txtDescAvaliacaoDiagnosticoSemCID" value="" maxlength="250" type="text">
	</div>
</div>
<div id="modelTecnologia" class="col-md-12"><div class="form-group" style="margin:0">
	<p class="lead"  >Descrição da Tecnologia</p>
</div>
<div class="form-group  col-md-6" >
	<label for="selTipoTecnologia" class="col-sm-4 control-label">Tipo da Tecnologia</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selTipoTecnologia" id="selTipoTecnologia" data-condition-fields="selDisponivelSus, txtDcb, txtDcbComercial, txtProcedimento, txtProduto, txaPosologia, selUsoContinuo, txtDuracaoTratamento, selRegistroAnvisa, selSituacaoAnvisa, selIndicacaoConformidade, selOncologico, selPrevistoProtocolo, selExisteGenerico, selExisteBiossimilar, txaGenericoBiossimilar, selTabelaTecnologia, txtCustoTecnologia, txtLaboratorio, txtMarcaComercial, txtApresentacao, txtPrecoFabrica, txtPrecoMaximoGoverno, txtPrecoMaximoConsumidor, lblCustoTratamentoMensal, txtTecnologiaC, txtDoseDiariaRecomendada, txtPrecoMaximoGovernoTratamentoMensal, txtPrecoMaximoConsumidorTratamentoMensal">
		<option value="" >Selecione</option>
		<option value="1" >Medicamento</option>
		<option value="2" >Procedimento</option>
		<option value="3" >Produto</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selRegistroAnvisa" class="col-sm-4 control-label">Registro na ANVISA?</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selRegistroAnvisa" id="selRegistroAnvisa" data-condition-fields="selSituacaoAnvisa" data-condition="$('#selTipoTecnologia').val() == '1' || $('#selTipoTecnologia').val() == '3'">
		<option value="" >Selecione</option>
		<option value="S" >Sim</option>
		<option value="N" >Não</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selSituacaoAnvisa" class="col-sm-4 control-label">Situação do registro</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selSituacaoAnvisa" id="selSituacaoAnvisa" data-condition="($('#selTipoTecnologia').val() == '1' || $('#selTipoTecnologia').val() == '3') && $('#selRegistroAnvisa').val() == 'S'">
		<option value="" >Selecione</option>
		<option value="A" >Válido</option>
		<option value="I" >Caduco/Cancelado</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="txtDcbComercial" class="col-sm-4 control-label">Nome comercial</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="txtDcbComercial" id="txtDcbComercial" data-allow-create="false" data-source="medicamentoComercial" data-condition="$('#selTipoTecnologia').val() == '1'">
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="txtDcb" class="col-sm-4 control-label">Princípio Ativo</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="txtDcb" id="txtDcb" data-source="principioAtivo" data-condition="$('#selTipoTecnologia').val() == '1'">
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="txtProcedimento" class="col-sm-4 control-label">Descrição</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="txtProcedimento" id="txtProcedimento" maxlength="200" data-source="procedimento" data-condition="$('#selTipoTecnologia').val() == '2'">
		</select>
	</div>
</div>
<div class="form-group col-md-6" >
	<label for="txtProduto" class="col-sm-4 control-label">Descrição</label>
	<div class="col-sm-8 col-lg-7">
		<input class="form-control  " name="txtProduto" id="txtProduto" value="" maxlength="200" type="text" data-condition="$('#selTipoTecnologia').val() == '3'">
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selDisponivelSus" class="col-sm-4 control-label">O <span class='labelTipoTecnologia'>produto, procedimento ou medicamento</span> está inserido no SUS?</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selDisponivelSus" id="selDisponivelSus" data-condition-fields="selTabelaTecnologia" data-condition="$('#selTipoTecnologia').val() != ''">
		<option value="" >Selecione</option>
		<option value="S" >Sim</option>
		<option value="N" >Não</option>
		<option value="B" >Não sabe</option>
		<option value="X" >Não informado</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selTabelaTecnologia" class="col-sm-4 control-label">O <span class='labelTipoTecnologia'>produto, procedimento ou medicamento</span> está incluído em</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selTabelaTecnologia" id="selTabelaTecnologia" data-condition="$('#selDisponivelSus').val() == 'S' && ($('#selTipoTecnologia').val() == '1' || $('#selTipoTecnologia').val() == '2' || $('#selTipoTecnologia').val() == '3')">
		<option value="" >Selecione</option>
		<option value="R" >RENAME</option>
		<option value="M" >REMUME</option>
		<option value="S" >SIGTAP</option>
		<option value="C" >Deliberação em CIB</option>
		<option value="N" >Nenhuma acima</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selOncologico" class="col-sm-4 control-label">Oncológico?</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selOncologico" id="selOncologico" data-condition="$('#selTipoTecnologia').val() == '1'">
		<option value="" >Selecione</option>
		<option value="S" >Sim</option>
		<option value="N" >Não</option>
		<option value="B" >Não sabe</option>
		<option value="X" >Não informado</option>
		</select>
	</div>
</div>
<script>
	$('#selTipoTecnologia').change(function(){
		var text = $(this).find(':selected').text();
		var extra = '';
		switch ($(this).val()) {
			case '1': extra = $('#txtDcb').val() || ""; break;
			case '2': extra = $('#txtProcedimento').val() || ""; break;
			case '3': extra = $('#txtProduto').val() || ""; break;
		}
		$('.labelTipoTecnologia').text($(this).val() > 0 ? text.toLowerCase() : "medicamento, procedimento ou produto");
		$('.txtTecnologia').val($(this).val() > 0 ? text+(extra!=''?' - ':'')+extra : "");
	});
	$('#txtDcb,#txtProcedimento,#txtProduto').on('change keyup', function(){
		var extra = $(this).val() || "";
		$('.txtTecnologia').val($('#selTipoTecnologia option:selected').text()+(extra!=''?' - '+extra:''));
	});
	$('#txtDuracaoTratamento').after($('#selUnidadeDuracaoTratamento'));
	$('#selRegistroAnvisa').change(function(){
		if ($(this).val() == 'S') {
			$('#txtDcb,#txtDcbComercial').val('').change();
		}
		$('#txtDcb,#txtDcbComercial').attr('data-allow-create', ($(this).val()=='N'?'true':'false'));
	});
	$('#txtDcb').on('select2:select', function(e){
		if ($('#selRegistroAnvisa').val() == 'S') {
			$("#txtDcbComercial").val('').change();
		}
	});
	$('#txtDcbComercial').on('select2:select', function(e){
		var arr = $(this).val().split('|');
		$("#txtDcbComercial").val('').append("<option selected='selected'>"+$.trim(arr[0])+"</option>").trigger('change');
		if (arr.length > 1) {
			$("#txtDcb").val('').append("<option selected='selected'>"+$.trim(arr[1])+"</option>").trigger('change');
		}
	}).on('select2:unselect', function(e){
		if ($('#selRegistroAnvisa').val() == 'S') {
			$("#txtDcb").val('').change();
		}
	});
</script>
</div><div class="col-md-12"><div class="form-group" style="margin:0">
	<p class="lead"  >Conclusão</p>
</div>
<div class="form-group col-md-6" >
	<label for="txtTecnologiaE" class="col-sm-4 control-label">Tecnologia</label>
	<div class="col-sm-8 col-lg-7">
		<input class="form-control  txtTecnologia"  id="txtTecnologiaE" value="" type="text" readonly="readonly">
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selConclusao" class="col-sm-4 control-label">Conclusão Justificada</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selConclusao" id="selConclusao" >
		<option value="" >Selecione</option>
		<option value="F" >Favorável</option>
		<option value="N" >Não favorável</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="selEvidenciaCientifica" class="col-sm-4 control-label">Há evidências científicas?</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  " name="selEvidenciaCientifica" id="selEvidenciaCientifica" >
		<option value="" >Selecione</option>
		<option value="S" >Sim</option>
		<option value="N" >Não</option>
		<option value="B" >Não se aplica</option>
		</select>
	</div>
</div>
<div class="form-group  col-md-6" >
	<label for="txtNatResponsavel" class="col-sm-4 control-label">NatJus Responsável</label>
	<div class="col-sm-8 col-lg-7 ">
		<select class="form-control  select2" name="txtNatResponsavel" id="txtNatResponsavel" >
		<option value="" >Selecione</option>
		<option value="Nacional" >Nacional</option>
		<option value="AC" >AC - Acre</option>
		<option value="AL" >AL - Alagoas</option>
		<option value="AP" >AP - Amapá</option>
		<option value="AM" >AM - Amazonas</option>
		<option value="BA" >BA - Bahia</option>
		<option value="CE" >CE - Ceará</option>
		<option value="DF" >DF - Distrito Federal</option>
		<option value="ES" >ES - Espírito Santo</option>
		<option value="GO" >GO - Goiás</option>
		<option value="MA" >MA - Maranhão</option>
		<option value="MT" >MT - Mato Grosso</option>
		<option value="MS" >MS - Mato Grosso do Sul</option>
		<option value="MG" >MG - Minas Gerais</option>
		<option value="PA" >PA - Pará</option>
		<option value="PB" >PB - Paraíba</option>
		<option value="PR" >PR - Paraná</option>
		<option value="PE" >PE - Pernambuco</option>
		<option value="PI" >PI - Piauí</option>
		<option value="RJ" >RJ - Rio de Janeiro</option>
		<option value="RN" >RN - Rio Grande do Norte</option>
		<option value="RS" >RS - Rio Grande do Sul</option>
		<option value="RO" >RO - Rondônia</option>
		<option value="RR" >RR - Roraima</option>
		<option value="SC" >SC - Santa Catarina</option>
		<option value="SP" >SP - São Paulo</option>
		<option value="SE" >SE - Sergipe</option>
		<option value="TO" >TO - Tocantins</option>
		<option value="HC" >HCFMUSP - Hospital das Clínicas da Faculdade de Medicina da USP</option>
		</select>
	</div>
</div>
</div><script>
	processForm("formParecer", false);
</script>
	<div class='form-group'>
		<div class='col-md-10'></div>
		<div class='col-md-2'><button id='btnPesquisar' type="button" class="btn btn-primary">Pesquisar</button></div>
	</div>
	</form>
</div>
<div id="loading" style="margin-top:20px;display:none">
	<div align='center'><div class='loading'></div>Carregando...</div>
</div>
<div id="resultados" style="margin-top:20px;display:none">
	<table class="table table-striped table-hover" id="tabela-notaTecnica">
		<thead>
			<tr>
				<th>ID</th>
				<th>Data</th>
				<th>Tecnologia</th>
				<th>CID</th>
				<th>NatJus Responsável</th>
				<th>Status</th>
				<th class="btn-width-4"></th>
			</tr>
		</thead>
		<tbody id="tbody"></tbody>
	</table>
	<div id="pagination" style="text-align: center;">teste</div>
</div>
<script>
	//Limpando Session Storage dos Filtros de Listagem
	sessionStorage.clear()

	// $('#buscaTexto').keyup($.debounce(300, function(){
	// 	if ($('#buscaTexto').val() == '' || $('#buscaTexto').val().length >= 3) {
	// 		reloadDataTable('tabela-pesquisaPublica');
	// 	}
	// }));
	/*
	$('#buscaTexto').keypress(function(e){
		if (e.which == 13 && $(this).val().length > 0) {
			if ($(this).val().length < 3) {
				showToast('warning', 'Digite 3 ou mais caracteres para realizar uma busca');
			}
			else {
				ajaxPost('api/pesquisaPublica/listar', 'resultados', 'token=pesquisaPublica:1747330200:7da0cff01b16326bc28b342c8e99bcea85ca140d9d63cf2fd507e46b4d71b30c&buscaTexto='+$("#buscaTexto").val());
			}
		}
	}).focus();
	*/
	$(window).off('beforeunload');

	function removerNotaTecnica(idNotaTecnica) {
		showConfirm('Remover Nota Técnica '+idNotaTecnica+'?', function(){
			apiCall('notaTecnica/remover', 'idNotaTecnica='+idNotaTecnica, function(response){
				if (response.success == true) {
					showToast('success', 'Nota Técnica removida com sucesso');
					$('#btnPesquisar').click();
				}
				else if (response.message) {
					showToast('error', response.message);
				}
				else {
					showToast('error', 'Falha ao remover Nota Técnica');
				}
			});
		});
	}

	function chamadaAjaxPesquisa(pagina) {
		$.ajax({
			url: "api/pesquisaPublica/listar?" + $('form#frmPesquisa').serialize() + "&pagina=" + pagina,
			type: "POST",
			beforeSend: function() {
				$("#loading").show();
				window.scrollTo(0, 0);
			}
		}).done(function(response) {
			$(window).off('beforeunload');
			$("#loading").hide();
			var resposta = {};
			try {
				resposta = JSON.parse(response);
			} catch (_error) {
				resposta = response; // Caso a resposta já seja um objeto JSON
			}

			console.log(resposta);
			if (resposta.error) {
				showToast('warning', resposta.message);
			} else {
				atualizarResultados(resposta);
				atualizarPaginacao(resposta);
			}

			document.getElementById("btnPesquisar").scrollIntoView();
		});
	}

	function atualizarResultados(resposta) {
		$("#resultados").children("p:first").remove();
		$("#resultados").show();
		$("#resultados").prepend('<p><strong>Exibindo ' + resposta.recordsFiltered + ' de ' + resposta.recordsTotal + ' resultados encontrados.</strong></p>');

		document.getElementById('tbody').innerHTML = "";
		for (var key in resposta.data) {
			var tr = '<tr class="odd">' +
				'<td>' + resposta.data[key].idNotaTecnica + '</td>' +
				'<td>' + resposta.data[key].horaCriado + '</td>' +
				'<td>' + resposta.data[key].tecnologia + '</td>' +
				'<td>' + resposta.data[key].cid + '</td>' +
				'<td>' + resposta.data[key].natResponsavel + '</td>' +
				'<td>' + resposta.data[key].status + '</td>' +
				'<td>' +
				'<a class="btn btn-sm btn-success tooltipButton"  title="Nota Técnica" href="notaTecnica-dados.php?idNotaTecnica=' + resposta.data[key].idNotaTecnica + '"><span class="glyphicon glyphicon-book"></span></a> ' +
				'<a class="btn btn-sm btn-primary btn-download tooltipButton" title="Gerar documento" href="notaTecnica-dados.php?output=pdf&amp;token=' + resposta.data[key].token + '" ><span class="glyphicon glyphicon-save"></span></a> ' +
				(resposta.data[key].propria == 1 ? '<button type="button" onclick="removerNotaTecnica(' + resposta.data[key].idNotaTecnica + ')" class="btn btn-sm btn-danger tooltipButton" title="Remover Nota Técnica"><span class="glyphicon glyphicon-trash"></span></button>' : '') +
				'</td></tr>';

			$("#tbody").append(tr);
		}
	}

	function atualizarPaginacao(resposta) {
		var pagination = '<nav aria-label="Páginas">' +
			'<ul class="pagination justify-content-center">';

		// Botão "Anterior"
		pagination += '<li class="page-item' + (resposta.pagina == 1 ? ' disabled' : '') + '">' +
			'<a class="page-link" href="javascript:void(0);">Anterior</a></li>';

		// Páginas
		var startPage = Math.max(1, resposta.pagina - 2);
		var endPage = Math.min(resposta.paginasTotal, startPage + 4);

		for (let i = startPage; i <= endPage; i++) {
			if (resposta.pagina == i) {
				pagination += '<li class="page-item active"><a class="page-link" href="javascript:void(0);">' + i + '</a></li>';
			} else {
				pagination += '<li class="page-item"><a class="page-link" href="javascript:void(0);">' + i + '</a></li>';
			}
		}

		// Botão "Próximo"
		pagination += '<li class="page-item' + (resposta.pagina == resposta.paginasTotal ? ' disabled' : '') + '">' +
			'<a class="page-link" href="javascript:void(0);">Próximo</a></li>';

		pagination += '</ul></nav>';
		document.getElementById('pagination').innerHTML = pagination;
	}

	$('#btnPesquisar').click(function(e) {
		e.preventDefault();
		document.getElementById("loading").scrollIntoView();
		chamadaAjaxPesquisa(1);
	});

	$(document).on("click", ".page-link", function(e) {
		e.preventDefault();
		var clickedElement = $(e.target);
		var pagina = clickedElement.text();

		if (pagina === 'Anterior') {
			pagina = parseInt($('.pagination .active .page-link').text()) - 1;
		} else if (pagina === 'Próximo') {
			pagina = parseInt($('.pagination .active .page-link').text()) + 1;
		}

		document.getElementById('tbody').innerHTML = "";
		document.getElementById("loading").scrollIntoView();
		chamadaAjaxPesquisa(pagina);
	});
</script>
		</div> <!-- Fecha div #conteudo do header.inc.php -->
		<div class="modal" tabindex="-1" role="dialog" id="janela-modal">
			<div class="modal-dialog" role="document" id="janela-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title" id="janela-titulo"></h4>
					</div>
					<div class="modal-body" id="janela-conteudo"></div>
					<div class="modal-footer" id="janela-rodape">
						<button type="button" class="btn btn-primary" id="janela-salvar" style="display:none"><span class="glyphicon glyphicon-save"></span> <span id="janela-salvar-label">Salvar</span></button>
						<button type="button" class="btn btn-danger" id="janela-remover" style="display:none"><span class="glyphicon glyphicon-trash"></span> <span id="janela-remover-label">Remover</span></button>
						<button type="button" class="btn btn-default" data-dismiss="modal" id="janela-fechar"><span class="glyphicon glyphicon-remove"></span> Fechar</button>
					</div>
				</div>
			</div>
		</div>
<script>
	$('#janela-modal').on('shown.bs.modal', function(){
		var fieldInput = $(this).find('[autofocus]');
		if (fieldInput.length > 0) {
			var fldLength = fieldInput.val().length;
			fieldInput.focus();
			if (fldLength > 0) {
				fieldInput[0].setSelectionRange(fldLength, fldLength);
			}
		}
	});
	$('#janela-modal').on('hidden.bs.modal', function(){
		$('#janela-conteudo,#janela-titulo').html('');
		$('#janela-salvar,#janela-remover,#janela-fechar').off('click');
		$('#janela-salvar,#janela-remover').hide();
		$(window).off('beforeunload.save');
	});
	$(document).on('hidden.bs.modal', '.modal', function(){
		//resolve bug quando uma segunda modal fecha e tira o scroll da primeira
		if ($('.modal:visible').length) {
			$('body').addClass('modal-open');
		}
	});

</script>
		<div class='rodape'>
			Sistema e-NatJus v1.0.149
<br>
			2025® Todos os direitos reservados
		</div>
	</body>
</html>
